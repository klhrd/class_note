<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Markdown ç­†è¨˜ç€è¦½å™¨ v1.1.7</title>
    <style>
        /* v1.1.0: CSS è®Šæ•¸ */
        :root {
            --sidebar-width: 320px;
            --toggle-button-size: 30px;
            /* v1.1.0: é¡è‰²è®Šæ•¸ (æ·ºè‰²æ¨¡å¼) */
            --color-bg: #fff;
            --color-text: #333;
            --color-sidebar-bg: #f9f9f9;
            --color-border: #e0e0e0;
            --color-link: #1a73e8;
            --color-link-hover-bg: #e0e7ff;
            --color-link-active-bg: #1a73e8;
            --color-link-active-text: #ffffff;
            --color-shadow: rgba(0, 0, 0, 0.05);
            --color-header-bg: #fff;
            --color-resizer-bg: #f1f1f1;
            --color-resizer-hover-bg: #1a73e8;
            --color-menu-bg: #ffffff;
            --color-menu-shadow: rgba(0, 0, 0, 0.1);
            --color-menu-btn-bg: #f0f0f0;
            --color-menu-btn-hover-bg: #e0e0e0;
        }

        /* v1.1.0: æ·±è‰²æ¨¡å¼ */
        body.dark-mode {
            --color-bg: #2d333b;
            --color-text: #cdd9e5;
            --color-sidebar-bg: #22272e;
            --color-border: #444c56;
            --color-link: #58a6ff;
            --color-link-hover-bg: #388bfd4d;
            --color-link-active-bg: #58a6ff;
            --color-link-active-text: #ffffff;
            --color-shadow: rgba(0, 0, 0, 0.2);
            --color-header-bg: #2d333b;
            --color-resizer-bg: #373e47;
            --color-resizer-hover-bg: #58a6ff;
            --color-menu-bg: #2d333b; /* é¸å–®èƒŒæ™¯ä¹Ÿè®Šæš— */
            --color-menu-shadow: rgba(0, 0, 0, 0.3);
            --color-menu-btn-bg: #444c56;
            --color-menu-btn-hover-bg: #555c66;
        }

        /* åŸºç¤æ¨£å¼å’Œä½ˆå±€ */
        body {
            margin: 0;
            display: flex; /* v1.1.3: ä½¿ç”¨ flex ä½ˆå±€ */
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            color: var(--color-text);
            background-color: var(--color-bg);
            height: 100vh;
            overflow: hidden; /* é˜²æ­¢ body æ»¾å‹• */
        }

        /* --- å´é‚Šæ¬„æ¨£å¼ (å¯æ»¾å‹•) --- */
        #sidebar {
            width: var(--sidebar-width); 
            min-width: 200px; 
            max-width: 80vw;  
            height: 100vh;
            overflow-y: auto;
            border-right: 1px solid var(--color-border);
            box-sizing: border-box;
            background-color: var(--color-sidebar-bg);
            box-shadow: 2px 0 5px var(--color-shadow);
            padding: 0;
            user-select: none;
            flex-shrink: 0; 
            z-index: 100;
            position: relative;
            /* v1.1.3: ç§»é™¤ transform */
        }

        /* v1.1.3: å´é‚Šæ¬„æ”¶åˆæ™‚çš„ç‹€æ…‹ (ä½¿ç”¨ display: none) */
        body.sidebar-collapsed #sidebar {
            display: none;
        }

        /* v1.1.2: æ¨™é¡Œå·²ç§»é™¤ */
        
        #file-tree-container {
            padding: 10px 20px;
        }

        /* æ ¹ç¯€é»çš„ UL ä¸éœ€è¦é¡å¤–ç¸®æ’ */
        #file-tree-container > ul {
             padding-left: 0;
        }

        /* --- æ¨¹ç‹€æª¢è¦– (Tree View) æ¨£å¼ --- */
        .tree-node {
            list-style-type: none;
            margin: 2px 0;
        }

        .tree-node ul {
            padding-left: 20px;
            margin: 5px 0 5px 12px;
            border-left: 1px dashed #ccc;
        }

        .tree-folder-title {
            cursor: pointer;
            padding: 5px 8px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            font-weight: 500;
            transition: background-color 0.2s ease;
        }

        .tree-folder-title:hover {
            background-color: var(--color-link-hover-bg);
        }

        .tree-folder-title .icon {
            display: inline-block;
            width: 16px;
            text-align: center;
            margin-right: 5px;
            transition: transform 0.1s ease-in-out;
        }

        .tree-node.collapsed > .tree-folder-title .icon {
            transform: rotate(-90deg);
        }

        .tree-node.collapsed > ul {
            display: none;
        }

        .tree-file {
            display: block;
            padding: 5px 8px 5px 30px; 
            text-decoration: none;
            color: var(--color-text);
            border-radius: 6px;
            transition: all 0.2s ease;
            font-size: 0.95rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            user-select: text; 
        }

        .tree-file:hover {
            background-color: var(--color-link-hover-bg);
            color: var(--color-link);
        }

        .tree-file.active {
            font-weight: bold;
            background-color: var(--color-link-active-bg);
            color: var(--color-link-active-text);
            border-color: var(--color-link-active-bg);
        }

        /* --- å´é‚Šæ¬„å¯¬åº¦èª¿æ•´å™¨ --- */
        #resizer {
            width: 5px;
            height: 100vh;
            background: var(--color-resizer-bg);
            cursor: col-resize;
            transition: background-color 0.2s ease; /* v1.1.3: ç§»é™¤ transform å‹•ç•« */
            flex-shrink: 0;
            position: relative;
            z-index: 100;
        }
        #resizer:hover,
        #resizer.resizing {
            background: var(--color-resizer-hover-bg);
        }
        
        /* v1.1.3: å´é‚Šæ¬„æ”¶åˆæ™‚éš±è—èª¿æ•´å™¨ (ä½¿ç”¨ display: none) */
        body.sidebar-collapsed #resizer {
            display: none;
        }

        /* --- Markdown å®¹å™¨æ¨£å¼ --- */
        #markdown-view-container {
            flex-grow: 1; /* v1.1.3: flex ä½ˆå±€è‡ªå‹•å¡«æ»¿ */
            height: 100vh;
            overflow: hidden;
            position: relative;
            width: 0; /* v1.1.3: ç§»é™¤ width: 0 */
            z-index: 1;
            /* v1.1.3: ç§»é™¤æ‰€æœ‰ margin-left é‚è¼¯ */
        }
        
        /* ç”¨æ–¼é¡¯ç¤ºæ¸²æŸ“å¾Œ HTML çš„å®¹å™¨ */
        #markdown-content {
            padding: 20px 40px 40px 40px;
            height: 100vh;
            overflow-y: auto;
            box-sizing: border-box;
            width: 100%;
            font-size: 16px; 
        }

        /* --- v1.1.3: é¸å–®æŒ‰éˆ• --- */
        #menu-toggle {
            position: absolute;
            top: 10px;
            left: 10px; /* v1.1.3: ä½ç½®å›ºå®šåœ¨å·¦ä¸Šè§’ */
            z-index: 150; 
            width: var(--toggle-button-size);
            height: var(--toggle-button-size);
            background-color: rgba(255, 255, 255, 0.8);
            border: 1px solid #ccc;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            font-weight: bold;
            color: #333;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            transition: background-color 0.2s ease;
            /* v1.1.3: ç§»é™¤ left å‹•ç•« */
        }
        #menu-toggle:hover {
            background-color: #fff;
        }
        
        /* v1.1.3: SVG åœ–ç¤ºæ¨£å¼ */
        #menu-toggle svg {
            width: 20px;
            height: 20px;
            stroke: currentColor;
            stroke-width: 2.5;
            stroke-linecap: round;
            stroke-linejoin: round;
            fill: none;
        }

        /* v1.1.3: SVG åœ–ç¤ºåˆ‡æ›é‚è¼¯ */
        /* é è¨­: å´é‚Šæ¬„å±•é–‹, é¡¯ç¤º X */
        .icon-menu { display: none; }
        .icon-close { display: block; }
        /* å´é‚Šæ¬„æ”¶åˆæ™‚: é¡¯ç¤º â˜° */
        body.sidebar-collapsed .icon-menu { display: block; }
        body.sidebar-collapsed .icon-close { display: none; }
        
        
        /* v1.1.0: æ·±è‰²æ¨¡å¼ä¸‹çš„æŒ‰éˆ• */
        body.dark-mode #menu-toggle {
             background-color: var(--color-menu-btn-bg);
             border-color: var(--color-border);
             color: var(--color-text);
        }
        body.dark-mode #menu-toggle:hover {
             background-color: var(--color-menu-btn-hover-bg);
        }

        /* v1.1.1: è¨­å®šé¸å–® (ç§»å…¥å´é‚Šæ¬„) */
        #settings-menu {
            padding: 10px;
            width: auto; 
            border-top: 1px solid var(--color-border); 
        }
        
        .settings-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 10px; 
        }
        .settings-item button {
            padding: 5px 10px;
            font-size: 1rem;
            cursor: pointer;
            background-color: var(--color-menu-btn-bg);
            color: var(--color-text);
            border: 1px solid var(--color-border);
            border-radius: 5px;
        }
        .settings-item button:hover {
            background-color: var(--color-menu-btn-hover-bg);
        }
        
        /* v1.1.4: ç¾åŒ–å­—é«”æ§åˆ¶å™¨ */
        #font-size-controls {
            display: flex;
            align-items: center;
            gap: 8px; /* å¢åŠ é–“è· */
        }
        #font-slider {
            flex-grow: 1; /* æ»‘æ¡¿å¡«æ»¿å‰©é¤˜ç©ºé–“ */
        }
        #font-input {
            width: 50px;
            padding: 4px;
            border: 1px solid var(--color-border);
            background-color: var(--color-bg);
            color: var(--color-text);
            border-radius: 4px;
            text-align: center;
        }

        .settings-divider {
            height: 1px;
            background-color: var(--color-border);
            margin: 8px 0;
        }
        #version-info {
            font-size: 0.8rem;
            color: #888;
            text-align: center;
            padding-top: 5px;
        }
        /* ç°¡æ˜“çš„ Checkbox Toggle */
        .switch {
          position: relative;
          display: inline-block;
          width: 44px;
          height: 24px;
        }
        .switch input { display: none; }
        .slider {
          position: absolute;
          cursor: pointer;
          top: 0;
          left: 0;
          right: 0;
          bottom: 0;
          background-color: #ccc;
          transition: .4s;
          border-radius: 24px;
        }
        .slider:before {
          position: absolute;
          content: "";
          height: 16px;
          width: 16px;
          left: 4px;
          bottom: 4px;
          background-color: white;
          transition: .4s;
          border-radius: 50%;
        }
        input:checked + .slider {
          background-color: var(--color-link);
        }
        input:checked + .slider:before {
          transform: translateX(20px);
        }

        /* v1.1.4: ç¾åŒ–æ²è»¸ */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: var(--color-sidebar-bg);
        }
        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        body.dark-mode ::-webkit-scrollbar-track {
            background: var(--color-sidebar-bg);
        }
        body.dark-mode ::-webkit-scrollbar-thumb {
            background: #555;
        }
        body.dark-mode ::-webkit-scrollbar-thumb:hover {
            background: #777;
        }

        /* è¼‰å…¥å’ŒéŒ¯èª¤æç¤º */
        .status-message {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 1.5rem;
            color: #777;
            padding: 20px;
            background-color: rgba(255, 255, 255, 0.8);
            border-radius: 8px;
            z-index: 20; /* ç¢ºä¿åœ¨ markdown å…§å®¹ä¹‹ä¸Š */
            /* v1.1.4: è®“é€£çµå¯ä»¥é»æ“Š */
            pointer-events: all;
            text-align: center; /* è®“éŒ¯èª¤è¨Šæ¯å±…ä¸­ */
        }
        body.dark-mode .status-message {
            color: #aaa;
            background-color: rgba(60, 60, 60, 0.8);
        }
        .status-message.error {
            color: #D32F2F; /* ç´…è‰² */
        }
        .status-message a {
            font-weight: 500;
        }
        
        .sidebar-status {
            padding: 20px;
            font-size: 1rem;
            color: #777;
        }
        .sidebar-status.error {
             color: #D32F2F;
        }

    </style>
    
    <!-- v1.1.0: å¼•å…¥ GitHub Markdown æ¨£å¼ (æ·ºè‰²) -->
    <link id="light-theme" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/5.1.0/github-markdown-light.min.css">
    <!-- v1.1.0: å¼•å…¥ GitHub Markdown æ¨£å¼ (æ·±è‰², é è¨­ç¦ç”¨) -->
    <link id="dark-theme" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/5.1.0/github-markdown-dark.min.css" disabled>
    
    <!-- v1.1.0: å¼•å…¥ KaTeX (LaTeX æ¸²æŸ“) -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.css">


</head>
<body class=""> <!-- v1.1.3: é è¨­å±•é–‹å´é‚Šæ¬„ -->
    <div id="sidebar">
        <!-- v1.1.2: ç§»é™¤æ¨™é¡Œ -->
        <div id="file-tree-container">
            <!-- æª”æ¡ˆæ¨¹å°‡åœ¨é€™è£¡å‹•æ…‹ç”Ÿæˆ -->
            <div class="sidebar-status" id="sidebar-status">æ­£åœ¨è¼‰å…¥...</div>
        </div>
        
        <!-- v1.1.1: å°‡è¨­å®šé¸å–®ç§»è‡³å´é‚Šæ¬„åº•éƒ¨ -->
        <div id="settings-menu">
            <div class="settings-divider"></div>
            <div class="settings-item">
                <span>æ·±è‰²æ¨¡å¼</span>
                <label class="switch">
                    <input type="checkbox" id="dark-mode-toggle">
                    <span class="slider"></span>
                </label>
            </div>
            <div class="settings-item">
                <span>å­—é«”å¤§å°</span>
                <!-- v1.1.4: æ›´æ–°ç‚ºæ»‘æ¡¿å’Œè¼¸å…¥æ¡† -->
                <div id="font-size-controls">
                    <input type="range" id="font-slider" min="10" max="32" step="1">
                    <input type="number" id="font-input" min="10" max="32">
                </div>
            </div>
            <div class="settings-divider"></div>
            <div id="version-info">
                ç‰ˆæœ¬: v1.1.7
            </div>
        </div>
    </div>
    
    <div id="resizer"></div>

    <div id="markdown-view-container">
        <!-- v1.1.3: æŒ‰éˆ• HTML çµæ§‹æ›´æ–° (ä½¿ç”¨ SVG) -->
        <button id="menu-toggle" title="æ”¶åˆé¸å–®">
            <!-- â˜° Menu Icon -->
            <svg class="icon-menu" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <line x1="3" y1="12" x2="21" y2="12"></line>
                <line x1="3" y1="6" x2="21" y2="6"></line>
                <line x1="3" y1="18" x2="21" y2="18"></line>
            </svg>
            <!-- âœ• Close Icon -->
            <svg class="icon-close" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
        </button>

        <!-- v1.1.1: ç§»é™¤èˆŠçš„è¨­å®šé¸å–® -->
        
        <!-- å°‡ svg æ›¿æ›ç‚º div å®¹å™¨ -->
        <div id="markdown-content" class="markdown-body"></div>
        
        <div id="content-status" class="status-message">è«‹å¾å·¦å´é¸æ“‡ä¸€å€‹ç­†è¨˜æª”æ¡ˆ</div>
    </div>
    
    <!-- v1.1.0: å¼•å…¥ marked.js ç”¨æ–¼æ¸²æŸ“ Markdown -->
    <script src="https://cdn.jsdelivr.net/npm/marked@4.3.0/marked.min.js"></script>
    
    <!-- v1.1.1: å¼•å…¥ KaTeX JS å’Œ auto-render æ“´å…… (ä¿®å¾© LaTeX) -->
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/contrib/auto-render.min.js"></script>


    <script>
        // =================================================================
        //                 ğŸ”” GitHub è³‡è¨Š (è«‹ä¿®æ”¹é€™è£¡) ğŸ””
        // =================================================================
        const GITHUB_USERNAME = 'klhrd';      
        const REPO_NAME = 'class_note';       
        const BRANCH_NAME = 'main'; // æˆ–æ˜¯ 'master'
        // v1.1.6: æª”æ¡ˆæ’é™¤åˆ—è¡¨
        const EXCLUDE_FILES = ['README.md']; 
        // =================================================================
        
        const MARKDOWN_EXTENSION = '.md';
        
        const fileLinksMap = new Map();
        let activeLink = null;
        let currentMarkdownPath = null; // v1.1.0: è¿½è¹¤ç›®å‰è·¯å¾‘ä»¥ä¿®å¾©åœ–ç‰‡
        let currentFontSize = 16; // v1.1.0: é è¨­å­—é«”å¤§å°

        // v1.1.0: marked.js æ¸²æŸ“å™¨ (ç”¨æ–¼ä¿®å¾©åœ–ç‰‡è·¯å¾‘)
        const renderer = new marked.Renderer();
        const originalImageRenderer = renderer.image;
        renderer.image = (href, title, text) => {
            // æª¢æŸ¥æ˜¯å¦ç‚ºç›¸å°è·¯å¾‘ (ä¸æ˜¯ http://, https://, æˆ– data:)
            if (href && !href.startsWith('http') && !href.startsWith('data:')) {
                let basePath = '';
                if (currentMarkdownPath) {
                    // å–å¾—æª”æ¡ˆæ‰€åœ¨ç›®éŒ„
                    const pathParts = currentMarkdownPath.split('/');
                    pathParts.pop(); // ç§»é™¤æª”å
                    basePath = pathParts.join('/');
                }
                // çµ„åˆå‡º GitHub Raw çš„å®Œæ•´ URL
                const newHref = `https://raw.githubusercontent.com/${GITHUB_USERNAME}/${REPO_NAME}/${BRANCH_NAME}/${basePath ? basePath + '/' : ''}${href}`;
                return originalImageRenderer.call(renderer, newHref, title, text);
            }
            return originalImageRenderer.call(renderer, href, title, text);
        };
        
        // v1.1.0: è¨­å®š marked ä½¿ç”¨è‡ªè¨‚æ¸²æŸ“å™¨
        marked.use({ renderer });


        // ====== 1. Markdown æ¸²æŸ“æ ¸å¿ƒå‡½å¼ (v1.1.5 ä¿®æ”¹ - History è™•ç†) ======
        /**
         * æ¸²æŸ“ Markdown å…§å®¹ä¸¦æ›´æ–°å´é‚Šæ¬„ç‹€æ…‹ã€‚
         * @param {string} filePath - æª”æ¡ˆè·¯å¾‘ã€‚
         * @param {HTMLElement} sourceLink - è§¸ç™¼é»æ“Šçš„æª”æ¡ˆé€£çµå…ƒç´ ã€‚
         * @param {boolean} [isInitialLoad=false] - æ˜¯å¦ç‚ºæ‡‰ç”¨ç¨‹å¼å•Ÿå‹•æ™‚çš„åˆå§‹è¼‰å…¥ã€‚
         */
        async function renderMarkdown(filePath, sourceLink, isInitialLoad = false) {
            const contentStatus = document.getElementById('content-status');
            const contentEl = document.getElementById('markdown-content');
            
            currentMarkdownPath = filePath; // v1.1.0: å„²å­˜ç›®å‰è·¯å¾‘
            
            contentEl.innerHTML = ''; 
            contentStatus.textContent = `æ­£åœ¨è¼‰å…¥ ${filePath} çš„å…§å®¹...`;
            contentStatus.className = 'status-message'; 
            contentStatus.style.display = 'block';
            contentEl.scrollTop = 0; // v1.1.0: é»æ“Šæ–°æª”æ¡ˆæ™‚æ»¾å‹•åˆ°é ‚éƒ¨

            try {
                if (typeof marked === 'undefined') {
                    throw new Error("Marked.js å‡½å¼åº«å°šæœªè¼‰å…¥å®Œæˆã€‚");
                }

                const rawFileUrl = `https://raw.githubusercontent.com/${GITHUB_USERNAME}/${REPO_NAME}/${BRANCH_NAME}/${filePath}`;
                
                const response = await fetch(rawFileUrl);
                if (!response.ok) {
                    throw new Error(`ç„¡æ³•è¼‰å…¥æª”æ¡ˆ (HTTP ${response.status})`);
                }
                const markdownContent = await response.text();
                                
                if (!markdownContent.trim()) {
                    contentEl.innerHTML = '<em>é€™å€‹æª”æ¡ˆæ²’æœ‰å…§å®¹ã€‚</em>';
                } else {
                    // v1.1.1: å…ˆç”¨ marked æ¸²æŸ“
                    contentEl.innerHTML = marked.parse(markdownContent);
                }

                // v1.1.1: æ¥è‘—å‘¼å« KaTeX auto-render
                if (window.renderMathInElement) {
                    window.renderMathInElement(contentEl, {
                        delimiters: [
                            {left: '$$', right: '$$', display: true},
                            {left: '$', right: '$', display: false},
                            {left: '\\(', right: '\\)', display: false},
                            {left: '\\[', right: '\\]', display: true}
                        ],
                        throwOnError: false
                    });
                }
                
                contentStatus.style.display = 'none';
                
                if (sourceLink) {
                    if (activeLink) {
                        activeLink.classList.remove('active');
                    }
                    sourceLink.classList.add('active');
                    activeLink = sourceLink;
                    
                    // v1.1.5: åªæœ‰åœ¨ã€Œä½¿ç”¨è€…é»æ“Šã€æˆ–ã€Œéåˆå§‹è¼‰å…¥ã€æ™‚æ‰æ›´æ–° history
                    // ç¢ºä¿ F5 é‡æ–°æ•´ç†æ™‚ï¼ŒURL hash ä¸æœƒè¢« pushState è¦†è“‹
                    if (!isInitialLoad) {
                        history.pushState({ path: filePath }, null, `#${filePath}`);
                    }
                }

            } catch (error) {
                console.error("Markdown æ¸²æŸ“éŒ¯èª¤:", error);
                // v1.1.4: é¡¯ç¤º GitHub é€£çµ
                const githubFileUrl = `https://github.com/${GITHUB_USERNAME}/${REPO_NAME}/blob/${BRANCH_NAME}/${filePath}`;
                contentStatus.innerHTML = `âŒ æ¸²æŸ“éŒ¯èª¤: ${error.message}.<br>
                    <a href="${githubFileUrl}" target="_blank" style="color: var(--color-link); font-size: 1rem;">åœ¨ GitHub ä¸ŠæŸ¥çœ‹æª”æ¡ˆ</a>`;
                contentStatus.className = 'status-message error';
                contentStatus.style.display = 'block';
            }
        }

        // ====== 2. æª”æ¡ˆæ¨¹è³‡æ–™è™•ç† (v1.1.6 ä¿®æ”¹ - æ’é™¤æª”æ¡ˆ) ======
        async function fetchFileTree() {
            const apiUrl = `https://api.github.com/repos/${GITHUB_USERNAME}/${REPO_NAME}/git/trees/${BRANCH_NAME}?recursive=1`;
            const response = await fetch(apiUrl);
            if (!response.ok) {
                throw new Error(`ç„¡æ³•å¾ GitHub API å–å¾—æª”æ¡ˆæ¨¹ (HTTP ${response.status})`);
            }
            const data = await response.json();
            if (data.truncated) {
                console.warn("GitHub API å›æ‡‰è¢«æˆªæ–·ï¼Œæª”æ¡ˆåˆ—è¡¨å¯èƒ½ä¸å®Œæ•´ã€‚");
            }
            return data.tree
                .filter(item => 
                    item.type === 'blob' && 
                    item.path.endsWith(MARKDOWN_EXTENSION) &&
                    !EXCLUDE_FILES.includes(item.path) // v1.1.6: æ’é™¤ç‰¹å®šæª”æ¡ˆ
                )
                .map(item => item.path);
        }

        function buildTree(paths) {
            const root = { name: 'root', type: 'tree', children: [] };
            paths.forEach(path => {
                const parts = path.split('/');
                let currentNode = root;
                parts.forEach((part, index) => {
                    let childNode = currentNode.children.find(n => n.name === part);
                    const isFile = index === parts.length - 1;
                    if (!childNode) {
                        if (isFile) {
                            childNode = { name: part, type: 'blob', path: path };
                            currentNode.children.push(childNode);
                        } else {
                            childNode = {
                                name: part, type: 'tree',
                                path: parts.slice(0, index + 1).join('/'),
                                children: []
                            };
                            currentNode.children.push(childNode);
                        }
                    }
                    currentNode = childNode;
                });
            });
            const sortNodes = (nodes) => {
                nodes.sort((a, b) => {
                    if (a.type !== b.type) return a.type === 'tree' ? -1 : 1; 
                    return a.name.localeCompare(b.name, 'zh-TW'); 
                });
                nodes.forEach(node => {
                    if (node.type === 'tree') sortNodes(node.children);
                });
            };
            sortNodes(root.children);
            return root;
        }

        // ====== 3. æ¸²æŸ“å´é‚Šæ¬„ (Tree View) (v1.1.5 ä¿®æ”¹ - findAndSelectFile åƒæ•¸) ======
        function createTreeViewNode(node) {
            const li = document.createElement('li');
            li.className = 'tree-node';
            if (node.type === 'tree') {
                li.classList.add('collapsed'); 
                const title = document.createElement('div');
                title.className = 'tree-folder-title';
                title.innerHTML = `<span class="icon">â–¶</span> <span>${node.name}</span>`;
                title.addEventListener('click', (e) => {
                    e.stopPropagation(); 
                    li.classList.toggle('collapsed');
                });
                li.appendChild(title);
                const childrenUl = document.createElement('ul');
                node.children.forEach(child => {
                    childrenUl.appendChild(createTreeViewNode(child));
                });
                li.appendChild(childrenUl);
            } else if (node.type === 'blob') {
                li.classList.add('tree-file-node');
                const link = document.createElement('a');
                link.className = 'tree-file';
                link.href = `#${node.path}`;
                link.textContent = node.name; 
                link.dataset.path = node.path; 
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    // v1.1.5: ä½¿ç”¨è€…é»æ“Šï¼ŒisInitialLoad=false (é è¨­)
                    renderMarkdown(node.path, link, false); 
                    // v1.1.4: ç§»é™¤è‡ªå‹•é—œé–‰å´é‚Šæ¬„
                    // document.body.classList.add('sidebar-collapsed'); 
                });
                li.appendChild(link);
                fileLinksMap.set(node.path, link); 
            }
            return li;
        }

        /**
         * å°‹æ‰¾ä¸¦é¸å–æª”æ¡ˆï¼ŒåŒæ™‚å±•é–‹æª”æ¡ˆæ¨¹ã€‚
         * @param {string} path - æª”æ¡ˆè·¯å¾‘ã€‚
         * @param {boolean} [isInitialLoad=false] - æ˜¯å¦ç‚ºåˆå§‹è¼‰å…¥ã€‚
         */
        function findAndSelectFile(path, isInitialLoad = false) { // v1.1.5: æ–°å¢ isInitialLoad åƒæ•¸
            const link = fileLinksMap.get(path);
            if (!link) return false;
            
            // v1.1.5: å‚³å…¥ isInitialLoad
            renderMarkdown(path, link, isInitialLoad); 
            
            let currentNode = link.parentElement; 
            while (currentNode && currentNode.id !== 'file-tree-container') {
                if (currentNode.tagName === 'LI' && currentNode.classList.contains('tree-node')) {
                    currentNode.classList.remove('collapsed'); 
                }
                currentNode = currentNode.parentElement;
            }
            // v1.1.3: è‡ªå‹•å±•é–‹å´é‚Šæ¬„ä»¥é¡¯ç¤ºæª”æ¡ˆ
            document.body.classList.remove('sidebar-collapsed');
            // v1.1.3: ç§»é™¤ textContent è®Šæ›´ (ç”± CSS è™•ç†)
            link.scrollIntoView({ behavior: 'smooth', block: 'center' });
            return true;
        }

        // ====== 4. åˆå§‹åŒ–æ‡‰ç”¨ç¨‹å¼ (v1.1.7 ä¿®æ”¹ - è™•ç†ç„¡æ•ˆ Hash) ======
        async function initializeApp() {
            const container = document.getElementById('file-tree-container');
            const statusEl = document.getElementById('sidebar-status');
            try {
                const paths = await fetchFileTree();
                if (paths.length === 0) {
                    throw new Error("å„²å­˜åº«ä¸­æ‰¾ä¸åˆ°ä»»ä½• .md æª”æ¡ˆã€‚");
                }
                const tree = buildTree(paths);
                statusEl.remove();
                const rootUl = document.createElement('ul');
                const repoNode = { name: REPO_NAME, type: 'tree', children: tree.children };
                const repoLi = createTreeViewNode(repoNode);
                repoLi.classList.remove('collapsed');
                rootUl.appendChild(repoLi);
                container.appendChild(rootUl);

                // v1.1.6: ä¿®æ­£ - å¿…é ˆè§£ç¢¼ URL hash
                const hashPath = decodeURIComponent(window.location.hash.substring(1));
                let loaded = false;

                if (hashPath) {
                    loaded = findAndSelectFile(hashPath, true); // åˆå§‹è¼‰å…¥ = true
                    
                    // v1.1.7: æª¢æŸ¥ hashPath æ˜¯å¦æœ‰æ•ˆ
                    if (!loaded) {
                        // æª”æ¡ˆä¸å­˜åœ¨ï¼Œé¡¯ç¤ºéŒ¯èª¤è¨Šæ¯
                        const contentStatus = document.getElementById('content-status');
                        contentStatus.innerHTML = `âŒ æª”æ¡ˆä¸å­˜åœ¨: ${hashPath}<br>
                            <span style="font-size: 1rem;">è«‹å¾å·¦å´é¸å–®é¸æ“‡ä¸€å€‹æœ‰æ•ˆçš„æª”æ¡ˆã€‚</span>`;
                        contentStatus.className = 'status-message error';
                        contentStatus.style.display = 'block';
                        // ä¿æŒå´é‚Šæ¬„å±•é–‹
                        document.body.classList.remove('sidebar-collapsed');
                    }
                } else {
                    // v1.1.7: å¦‚æœæ²’æœ‰ hash, è¼‰å…¥ç¬¬ä¸€å€‹æª”æ¡ˆ
                    if (fileLinksMap.size > 0) {
                        const firstFile = fileLinksMap.keys().next().value;
                        loaded = findAndSelectFile(firstFile, true); // åˆå§‹è¼‰å…¥ = true
                    }
                }
                
                // v1.1.7: ç¢ºä¿åœ¨æˆåŠŸè¼‰å…¥æ™‚å´é‚Šæ¬„æ˜¯å±•é–‹çš„
                // (å¦‚æœ hash ç„¡æ•ˆ, loaded æœƒæ˜¯ false, å´é‚Šæ¬„æœƒä¿æŒå±•é–‹)
                if (loaded) {
                     document.body.classList.remove('sidebar-collapsed');
                }

            } catch (error) {
                console.error("åˆå§‹åŒ–æ‡‰ç”¨ç¨‹å¼éŒ¯èª¤:", error);
                statusEl.textContent = `âŒ è¼‰å…¥éŒ¯èª¤: ${error.message}`;
                statusEl.className = 'sidebar-status error';
            }
        }
        
        // ====== 5. è™•ç†ç€è¦½å™¨è¿”å›/å‰é€²æŒ‰éˆ• (v1.1.6 ä¿®æ”¹ - è§£ç¢¼) ======
        window.addEventListener('popstate', (event) => {
            let path;
            if (event.state && event.state.path) {
                path = event.state.path;
            } else {
                // v1.1.6: å¿…é ˆè§£ç¢¼ URL
                path = decodeURIComponent(window.location.hash.substring(1));
            }
            // v1.1.5: ç€è¦½å™¨å°èˆªå‹•ä½œï¼Œè¦–ç‚ºéåˆå§‹è¼‰å…¥ (æœƒå†æ¬¡å‘¼å« pushState ä½†æ²’é—œä¿‚)
            if (path) findAndSelectFile(path, false); 
        });

        // ====== 6. è™•ç†å´é‚Šæ¬„å¯¬åº¦èª¿æ•´ (v1.1.3 ä¿®æ”¹) ======
        function setupResizer() {
            const resizer = document.getElementById('resizer');
            if (!resizer) return;
            const sidebar = document.getElementById('sidebar');
            const container = document.querySelector('body');
            let isResizing = false;
            const resize = (e) => {
                if (!isResizing) return;
                const clientX = e.touches ? e.touches[0].clientX : e.clientX;
                let newWidth = clientX; // v1.1.3: ç°¡åŒ–é‚è¼¯
                const minWidth = parseInt(getComputedStyle(sidebar).minWidth, 10);
                const maxWidth = parseInt(getComputedStyle(sidebar).maxWidth, 10);
                if (newWidth < minWidth) newWidth = minWidth;
                if (newWidth > maxWidth) newWidth = maxWidth;
                document.documentElement.style.setProperty('--sidebar-width', `${newWidth}px`);
                
                // v1.1.3: ç§»é™¤æŒ‰éˆ•ä½ç½®æ›´æ–°
            };
            const stopResize = () => {
                isResizing = false;
                resizer.classList.remove('resizing');
                window.removeEventListener('pointermove', resize);
                window.removeEventListener('pointerup', stopResize);
            };
            resizer.addEventListener('pointerdown', (e) => {
                isResizing = true;
                resizer.classList.add('resizing');
                e.preventDefault(); 
                window.addEventListener('pointermove', resize);
                window.addEventListener('pointerup', stopResize);
            });
        }
        // ====== 7. (v1.1.4) è™•ç†è¨­å®šé¸å–® ======
        function setupSettingsMenu() {
            const menuToggle = document.getElementById('menu-toggle');
            const darkModeToggle = document.getElementById('dark-mode-toggle');
            // v1.1.4: æ›´æ–°æ§åˆ¶å™¨
            const fontSlider = document.getElementById('font-slider');
            const fontInput = document.getElementById('font-input');
            const contentEl = document.getElementById('markdown-content');
            
            if (!menuToggle || !darkModeToggle || !fontSlider || !fontInput || !contentEl) {
                console.error("è¨­å®šé¸å–®çš„æŸäº›å…ƒä»¶æ‰¾ä¸åˆ°ã€‚");
                return;
            }

            // é»æ“Šé¸å–®æŒ‰éˆ• (â˜° / âœ•)
            menuToggle.addEventListener('click', (e) => {
                e.stopPropagation();
                document.body.classList.toggle('sidebar-collapsed');
                // v1.1.3: ç§»é™¤ textContent è®Šæ›´ (ç”± CSS è™•ç†)
            });


            // é»æ“Šã€Œæ·±è‰²æ¨¡å¼ã€
            darkModeToggle.addEventListener('change', () => {
                const isDarkMode = darkModeToggle.checked;
                setDarkMode(isDarkMode);
                localStorage.setItem('darkMode', isDarkMode);
            });

            // v1.1.4: ç›£è½æ»‘æ¡¿
            fontSlider.addEventListener('input', () => {
                updateFontSize(parseInt(fontSlider.value, 10));
            });
            // v1.1.4: ç›£è½æ•¸å­—è¼¸å…¥
            fontInput.addEventListener('input', () => {
                // v1.1.7: ä¿®æ­£è¼¸å…¥æ¡†é‚è¼¯ï¼Œé˜²æ­¢åœ¨è¼¸å…¥ä¸­æ™‚è¢«æ¸…ç©º
                const val = parseInt(fontInput.value, 10);
                if (!isNaN(val)) {
                    updateFontSize(val);
                }
            });
            // v1.1.7: å¢åŠ  change äº‹ä»¶ï¼Œè™•ç†è¼¸å…¥å®Œæˆå¾Œ (ä¾‹å¦‚æŒ‰ Enter)
            fontInput.addEventListener('change', () => {
                 updateFontSize(parseInt(fontInput.value, 10));
            });


            function updateFontSize(newSize) {
                // ç¢ºä¿å­—é«”å¤§å°åœ¨ç¯„åœå…§
                // v1.1.7: ä¿®æ­£ - æª¢æŸ¥ newSize æ˜¯å¦ç‚º NaN
                if (newSize && !isNaN(newSize)) {
                    currentFontSize = Math.max(10, Math.min(32, newSize));
                }
                
                contentEl.style.fontSize = `${currentFontSize}px`;
                fontSlider.value = currentFontSize;
                fontInput.value = currentFontSize;
                
                localStorage.setItem('fontSize', currentFontSize);
            }

            function setDarkMode(isDark) {
                const lightTheme = document.getElementById('light-theme');
                const darkTheme = document.getElementById('dark-theme');
                if (isDark) {
                    document.body.classList.add('dark-mode');
                    lightTheme.disabled = true;
                    darkTheme.disabled = false;
                } else {
                    document.body.classList.remove('dark-mode');
                    lightTheme.disabled = false;
                    darkTheme.disabled = true;
                }
                darkModeToggle.checked = isDark;
            }

            // è¼‰å…¥å„²å­˜çš„è¨­å®š
            const savedDarkMode = localStorage.getItem('darkMode') === 'true';
            setDarkMode(savedDarkMode);
            
            const savedFontSize = parseInt(localStorage.getItem('fontSize'), 10);
            if (!isNaN(savedFontSize)) {
                currentFontSize = savedFontSize;
                updateFontSize(); // v1.1.4: å‘¼å« updateFontSize ä¾†åŒæ­¥æ‰€æœ‰
            } else {
                updateFontSize(); // v1.1.4: ç¢ºä¿åˆå§‹å€¼è¢«è¨­å®š
            }
        }


        // 'load' äº‹ä»¶æœƒç­‰å¾…æ‰€æœ‰å¤–éƒ¨è³‡æº (åŒ…å« marked.js å’Œ KaTeX) éƒ½è¼‰å…¥å®Œæˆ
        window.addEventListener('load', () => {
            initializeApp();
            setupResizer(); 
            setupSettingsMenu(); // <-- v1.1.1: è¨­å®šé¸å–®
        });
    </script>
</body>
</html>
